<!DOCTYPE html>
<html lang="en" xmlns:th="">
<head>
    <meta charset="UTF-8">
    <title>WaterMelon</title>

    <!--  Google Icon  -->
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>


    <!-- common.css    -->
    <link rel="stylesheet" type="text/css" href="/css/common.css">
    <link rel="stylesheet" type="text/css" href="/css/header.css">
    <link rel="stylesheet" type="text/css" href="/css/mylist.css">
    <link rel="stylesheet" type="text/css" href="/css/footer.css">

    <!-- favicon.ico   -->
    <link rel="icon" href="/images/favicon/favicon.ico" />
</head>
<body>
<div class="wrapper">
    <!-- 메인 -->
    <header>
        <div class="top-header">
            <a href="/main" ><img class="logo" src="/images/로고.png" alt=""></a>
            <form action="/search" method="get">
                <div class="search_box">
                    <select name="type"  class="selectbox" >
                        <option value="title" selected>TITLE</option>
                        <option value="artist">ARTIST</option>
                    </select>
                    <input id="searchInput" type="text" name="searchText" placeholder="듣고 싶은 노래를 검색하세요!" >
                    <button type="submit">🔍</button>
                </div>
            </form>
            <ul>
                <li><a href="/membership"
                       style="color:rgb(92, 115, 6); font-family: 'SDSamliphopangche_Basic'; font-size: 19px;"><img
                        src="/images/add.png" alt=""> 멤버십가입</a></li>
                <li><a href=""><img src="/images/english.png" alt="">ENGLISH</a></li>
            </ul>
        </div>
    </header>
    <nav>
        <div class="mobilemenu">
                <span href="" class="material-symbols-outlined">menu
                    <ul class="wa">
                        <li><a href="">수박차트</a></li>
                        <li><a href="">수박DJ</a></li>
                        <li><a href="">수박TV</a></li>
                        <li><a href="">수박매거진</a></li>
                        <li><a href="">공지사항</a></li>
                        <li><a href="">마이페이지</a></li>
                    </ul>
                </span>
        </div>
        <div class="navi">
            <div class="Menu_left">
                <ul class="one--depth">
                    <li>
                        <a href="">수박차트</a>
                        <ul class="two--depth">
                            <li><a href="/Top100">TOP100</a></li>
                            <li><a href="">최신음악</a></li>
                            <li><a href="">장르음악</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="">수박DJ</a>
                        <ul class="two--depth">
                            <li><a href="">#투데이</a></li>
                            <li><a href="">테마장르</a></li>
                            <li><a href="">인기선곡</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="">수박TV</a>
                        <ul class="two--depth">
                            <li><a href="">뮤직비디오</a></li>
                            <li><a href="">수박방송</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="">수박매거진</a>
                        <ul class="two--depth">
                            <li><a href="./magazine.html">오늘의매거진</a></li>
                            <li><a href="">완결매거진</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <div class="Menu_right">
                <ul class="one--depth">
                    <li>
                        <a href="">공지사항</a>
                        <ul class="two--depth">
                            <li><a href="/notice/list">공지사항</a></li>
                            <li><a href="/qna/list">QnA</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="">마이페이지</a>
                        <ul class="two--depth">
                            <li><a href="/member/mypage">정보수정</a></li>
                            <li><a href="/inmylist">마이리스트</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="header_line"></div>
    <main>
        <section>
            <div class="sec_1">
                <!-- title -->
                <div id="mylist">MY LIST</div>
                <div style="width:100%">
                    <div class="mylist-header">
                        <div class="button">
                            <a    type="button">선택재생</a>
                            <a    type="button" id="selectDelete">선택삭제</a>
                        </div>
                    </div>

                    <div class="mylist-body">
                        <!-- body -->
                        <table>
                            <thead>
                            <tr>
                                <th><input type="checkbox" id="allCheck" name="allCheck"></th>
                                <th class="title_1">NO</th>
                                <th class="title_1">CODE</th>
                                <th class="title_2">TITLE</th>
                                <th class="title_1">ARTIST</th>
                                <th class="title_1">LIKE</th>
                            </tr>
                            </thead>
                            <tbody>
                            <!-- SEARCH LIST ITEMS -->
                            <th:block>
                                <tr th:each="myList, iterationStat  : ${MyList}">
                                    <th><input type="checkbox" name="rowCheck" value="${iterationStat.count}"></th>
                                    <td th:text="${iterationStat.count}"></td>
                                    <td th:text="${myList.music.music_code}"></td>
                                    <td th:text="${myList.music.title}"></td>
                                    <td th:text="${myList.music.artist}"></td>
                                    <td><a th:href="@{/mylist/like(music_code=${myList.music.music_code})}"
                                           class="like_btn">
                                        <span class="material-symbols-outlined">favorite</span><span
                                            th:text="${myList.music.mlike}" class="likeno"></span></a></td>
                                </tr>
                            </th:block>

                            </tbody>
                        </table>

                    </div>
                </div>
            </div>
        </section>
        <img class="top_btn" src="/images/topBtn.png">


    </main>
    <footer>
        <div class="footer_line"></div>
        <div>
            <ul class="footer_menu">
                <li><a href="">이용약관</a></li>
                <li><a href="">고객센터</a></li>
                <li><a href="">제휴/프로모션</a></li>
                <li><a href=""> 개인정보처리방침</a></li>
            </ul>
        </div>
        <p></p>
        <div class="Site_info">
            <img id="footer_logo" src="/images/로고.png" alt="">
            <span class="Sitename">(주)WATERMELON MUSIC</span>
            <span>대구광역시 중구 중앙대로 366 반월센트럴타워 10층</span>
            <span>대표이사 : 윤치연, 김예솔, 이헌지, 최정기</span>
            <span>사업자등록번호 : 024-04-02023</span>
            <br>
            <span>문의전화 : 1544-1111 (평일 09:00-18:00)</span>
            <span>WATERMELON MUSIC으로 음악과 함께하는 즐거운 하루 보내세요!</span>
        </div>

    </footer>

</div>

<!-- axios -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"
        integrity="sha512-uMtXmF28A2Ab/JJO2t/vYhlaa/3ahUOgj1Zf27M5rOo8/+fcTUVH0/E0ll68njmjrLqOBjXM3V9NiPFL5ywWPQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>

    const mTopBtn = document.querySelector(".top_btn");

    window.addEventListener("scroll", () => {
      let scVal = window.scrollY;

      if (scVal === 0) {
        mTopBtn.style.opacity = 0;
      } else {
        mTopBtn.style.opacity = 1;
        mTopBtn.classList.remove("active");
      }
    });


    mTopBtn.addEventListener("click", () => {
      window.scrollTo({
        top: 0,
        behavior: "smooth"
      });
    });


     //체크박스로 체크한 곡 삭제하기
        window.onload = function() {
            var allCheck = document.getElementById("allCheck");
            var rowCheckboxes = document.getElementsByName("rowCheck");
            var selectedMusicCodes = [];
            var username = "";  // 사용자 이름

            // username 가져오기
            axios.get('/user/info')
                .then(function(response) {
                    username = response.data;
                    console.log("User: " + username);
                })
                .catch(function(error){
                    console.error(error);
                });

            // allcheck 선택되었을 때 모두 선택
            allCheck.addEventListener("change", function() {
                for (var i = 0; i < rowCheckboxes.length; i++) {
                    rowCheckboxes[i].checked = allCheck.checked;
                    if (allCheck.checked) {
                        var musicCode = rowCheckboxes[i].parentElement.nextElementSibling.textContent;
                        addMusicCode(musicCode);
                    } else {
                        // allCheck가 선택이 해제되었을 때 배열에서 제거
                        var musicCode = rowCheckboxes[i].parentElement.nextElementSibling.textContent;
                        removeMusicCode(musicCode);
                    }
                }
                console.log("Selected Music Codes: " + selectedMusicCodes.join(", "));
            });

            for (var i = 0; i < rowCheckboxes.length; i++) {
                rowCheckboxes[i].addEventListener("change", function() {
                    if (this.checked) {
                        // 선택된 체크박스의 music_code 값을 얻기
                        var musicCode = this.parentElement.nextElementSibling.nextElementSibling.textContent;
                        // musicCode를 배열에 추가
                        addMusicCode(musicCode);
                    } else {
                        var musicCode = this.parentElement.nextElementSibling.nextElementSibling.textContent;
                        // 체크가 해제된 경우 배열에서 제거
                        removeMusicCode(musicCode);
                    }
                    console.log("Selected Music Codes: " + selectedMusicCodes.join(", "));
                });
            }

            // "선택삭제" 버튼 클릭 시 이벤트 처리
            document.querySelector("#selectDelete").addEventListener("click", function() {

                // 선택된 music_code 배열과 username을 서버로 보내기
                axios.post('/mylist/delete', {
                    musicCodes: selectedMusicCodes,
                    username: username
                })
                .then(function (response) {
                    console.log("Mylist delete Success");
                    alert("음악이 Mylist에서 삭제되었습니다!")
                    location.reload();
                })
                .catch(function (error) {
                    console.log(username);
                    console.log(selectedMusicCodes);
                    console.error("Mylist delete fail.. : ", error);
                });
            });

            function addMusicCode(musicCode) {
                if (selectedMusicCodes.indexOf(musicCode) === -1) {
                    selectedMusicCodes.push(musicCode);
                }
            }

            function removeMusicCode(musicCode) {
                var index = selectedMusicCodes.indexOf(musicCode);
                if (index > -1) {
                    selectedMusicCodes.splice(index, 1);
                }
            }
        }

</script>

</body>
</html>