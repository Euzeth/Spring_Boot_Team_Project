<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>search</title>

    <!--  Google Icon  -->
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">

    <!-- common.css    -->
    <link rel="stylesheet" type="text/css" href="/css/common.css">
    <link rel="stylesheet" type="text/css" href="/css/header.css">
    <link rel="stylesheet" type="text/css" href="/css/search.css">
    <link rel="stylesheet" type="text/css" href="/css/footer.css">
    <link rel="stylesheet" type="text/css" href="/css/songs.css">


    <!-- favicon.ico   -->
    <link rel="icon" href="/images/favicon/favicon.ico"/>
</head>
<body>
<div class="wrapper">
    <!-- Î©îÏù∏ -->
    <header>
        <div class="top-header">
            <a href="/main"><img class="logo" src="/images/Î°úÍ≥†.png" alt=""></a>
            <form action="/search" method="get">
                <div class="search_box">
                    <select name="type" class="selectbox">
                        <option value="title" selected>TITLE</option>
                        <option value="artist">ARTIST</option>
                    </select>
                    <input id="searchInput" type="text" name="searchText" placeholder="Îì£Í≥† Ïã∂ÏùÄ ÎÖ∏ÎûòÎ•º Í≤ÄÏÉâÌïòÏÑ∏Ïöî!">
                    <button type="submit">üîç</button>
                </div>
            </form>
            <ul>
                <li><a href="/membership"
                       style="color:rgb(92, 115, 6); font-family: 'SDSamliphopangche_Basic'; font-size: 19px;"><img
                        src="/images/add.png" alt=""> Î©§Î≤ÑÏã≠Í∞ÄÏûÖ</a></li>
                <li><a href=""><img src="/images/english.png" alt="">ENGLISH</a></li>
            </ul>
        </div>
    </header>
    <nav>
        <div class="mobilemenu">
                <span href="" class="material-symbols-outlined">menu
                    <ul class="wa">
                        <li><a href="">ÏàòÎ∞ïÏ∞®Ìä∏</a></li>
                        <li><a href="">ÏàòÎ∞ïDJ</a></li>
                        <li><a href="">ÏàòÎ∞ïTV</a></li>
                        <li><a href="">ÏàòÎ∞ïÎß§Í±∞ÏßÑ</a></li>
                        <li><a href="">Í≥µÏßÄÏÇ¨Ìï≠</a></li>
                        <li><a href="">ÎßàÏù¥ÌéòÏù¥ÏßÄ</a></li>
                    </ul>
                </span>
        </div>
        <div class="navi">
            <div class="Menu_left">
                <ul class="one--depth">
                    <li>
                        <a href="">ÏàòÎ∞ïÏ∞®Ìä∏</a>
                        <ul class="two--depth">
                            <li><a href="/Top100">TOP100</a></li>
                            <li><a href="">ÏµúÏã†ÏùåÏïÖ</a></li>
                            <li><a href="">Ïû•Î•¥ÏùåÏïÖ</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="">ÏàòÎ∞ïDJ</a>
                        <ul class="two--depth">
                            <li><a href="">#Ìà¨Îç∞Ïù¥</a></li>
                            <li><a href="">ÌÖåÎßàÏû•Î•¥</a></li>
                            <li><a href="">Ïù∏Í∏∞ÏÑ†Í≥°</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="">ÏàòÎ∞ïTV</a>
                        <ul class="two--depth">
                            <li><a href="">ÎÆ§ÏßÅÎπÑÎîîÏò§</a></li>
                            <li><a href="">ÏàòÎ∞ïÎ∞©ÏÜ°</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="">ÏàòÎ∞ïÎß§Í±∞ÏßÑ</a>
                        <ul class="two--depth">
                            <li><a href="">Ïò§ÎäòÏùòÎß§Í±∞ÏßÑ</a></li>
                            <li><a href="">ÏôÑÍ≤∞Îß§Í±∞ÏßÑ</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <div class="Menu_right">
                <ul class="one--depth">
                    <li>
                        <a href="">Í≥µÏßÄÏÇ¨Ìï≠</a>
                        <ul class="two--depth">
                            <li><a href="/notice/list">Í≥µÏßÄÏÇ¨Ìï≠</a></li>
                            <li><a href="/qna/list">QnA</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="">ÎßàÏù¥ÌéòÏù¥ÏßÄ</a>
                        <ul class="two--depth">
                            <li><a href="/member/mypage"/>Ï†ïÎ≥¥ÏàòÏ†ï</a></li>
                            <li><a href="/inmylist">ÎßàÏù¥Î¶¨Ïä§Ìä∏</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>

    </nav>
    <div class="header_line"></div>
    <main>
        <div class="wrap__music">
            <div class="music__inner">

                <!-- // music__img -->
                <div class="music__song">
                    <p class="name"></p>
                    <p class="artist"></p>
                </div>

                <!-- // music__song -->
                <div class="music__progress">
                    <div class="bar">
                        <audio id="main-audio" src="" ></audio>

                    </div>
                    <div class="timer">
                        <span class="current">0:00</span>
                        <span class="duration">0:00</span>
                    </div>
                </div>

                <!-- // music__progress -->
                <div class="music__control">
                    <i id="control-repeat" class="material-icons" title="Ï†ÑÏ≤¥ Î∞òÎ≥µ">repeat</i>
                    <i id="control-prev" class="material-icons" title="Ïù¥Ï†ÑÍ≥°">skip_previous</i>
                    <div class="play-pause">
                        <i id="control-play" class="material-icons" title="Ïû¨ÏÉù">play_arrow</i>
                        <!-- <i class="material-icons">pause</i> -->
                    </div>
                    <i id="control-next" class="material-icons" title="Îã§ÏùåÍ≥°">skip_next</i>
                    <i id="control-list" class="material-icons" title="Ïû¨ÏÉùÎ™©Î°ù">queue_music</i>
                    <!-- <i class="material-icons">repeat_one</i>
                    <i class="material-icons">shuffle</i> -->
                </div>

                <!-- // music__control -->
                <div class="music__list">
                    <div class="title">
                        <div>
                            <i class="material-icons queue">queue_music</i>
                            <span>Music List</span>
                        </div>
                        <i class="material-icons close">close</i>
                    </div>
                    <div class="list">
                        <ul>
                            <!-- Javascript -->

                        </ul>
                    </div>
                </div>
                <!-- // music__list -->

                <div class="volume">
                    <i class="material-icons icon-left">volume_off</i>
                    <input type="range" id="volume-slider" min="0" max="100">
                    <i class="material-icons icon-right">volume_up</i>
                </div>
            </div>
        </div>
        <section>
            <div class="sec_1">
                <!-- title -->
                <div id="search">SEARCH RESULT</div>
                <div style="width:100%">
                    <div class="search-header">
                        <div class="keyword">
                            Í≤ÄÏÉâÌïú <span th:text="${type}" style="text-transform:uppercase;"></span> ÌÇ§ÏõåÎìú (<span
                                style="color:red" ,
                                th:text="${searchText}"></span>)
                        </div>
                        <div class="button">
                            <a type="button">ÏÑ†ÌÉùÏû¨ÏÉù</a>
                            <a type="button" id="selectAdd">ÏÑ†ÌÉùÎã¥Í∏∞</a>
                        </div>
                    </div>

                    <div class="search-body">
                        <!-- body -->
                        <table>
                            <thead>
                            <tr>
                                <th><input type="checkbox" id="allCheck" name="allCheck"></th>
                                <th class="title_1">NO</th>
                                <th class="title_1">CODE</th>
                                <th class="title_2">TITLE</th>
                                <th class="title_1">ARTIST</th>
                                <th class="title_1">LIKE</th>
                                <th class="title_1">ADD</th>
                                <th class="title_1">COUNT</th>
                            </tr>
                            </thead>
                            <tbody>
                            <!-- SEARCH LIST ITEMS -->
                            <th:block>
                                <tr th:each="searchDto, iterationStat  : ${searchList}">
                                    <th><input type="checkbox" name="rowCheck" value="${iterationStat.count}"></th>
                                    <td th:text="${iterationStat.count}"></td>
                                    <td th:text="${searchDto.music_code}"></td>
                                    <td><a th:text="${searchDto.title}" class="Music-Click"></a></td>
                                    <td th:text="${searchDto.artist}" class="artist"></td>
                                    <td>
                                        <a th:href="@{/search/like(music_code=${searchDto.music_code},type=${type},searchText=${searchText})}"
                                           class="like_btn">
                                            <span class="material-symbols-outlined">favorite</span><span
                                                th:text="${searchDto.mlike}" class="likeno"></span></a>
                                    </td>
                                    <td>
                                        <a href="#" class="add_btn">
                                            <span class="material-symbols-outlined">add</span></a>
                                    </td>
                                    <td th:text="${searchDto.count}"></td>


                                </tr>
                            </th:block>

                            </tbody>
                        </table>

                    </div>
                </div>
            </div>
        </section>
        <img class="top_btn" src="/images/topBtn.png">
    </main>
    <footer>
        <div class="footer_line"></div>
        <div>
            <ul class="footer_menu">
                <li><a href="">Ïù¥Ïö©ÏïΩÍ¥Ä</a></li>
                <li><a href="">Í≥†Í∞ùÏÑºÌÑ∞</a></li>
                <li><a href="">Ï†úÌú¥/ÌîÑÎ°úÎ™®ÏÖò</a></li>
                <li><a href=""> Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®</a></li>
            </ul>
        </div>
        <p></p>
        <div class="Site_info">
            <img id="footer_logo" src="/images/Î°úÍ≥†.png" alt="">
            <span class="Sitename">(Ï£º)WATERMELON MUSIC</span>
            <span>ÎåÄÍµ¨Í¥ëÏó≠Ïãú Ï§ëÍµ¨ Ï§ëÏïôÎåÄÎ°ú 366 Î∞òÏõîÏÑºÌä∏Îü¥ÌÉÄÏõå 10Ï∏µ</span>
            <span>ÎåÄÌëúÏù¥ÏÇ¨ : Ïú§ÏπòÏó∞, ÍπÄÏòàÏÜî, Ïù¥ÌóåÏßÄ, ÏµúÏ†ïÍ∏∞</span>
            <span>ÏÇ¨ÏóÖÏûêÎì±Î°ùÎ≤àÌò∏ : 024-04-02023</span>
            <br>
            <span>Î¨∏ÏùòÏ†ÑÌôî : 1544-1111 (ÌèâÏùº 09:00-18:00)</span>
            <span>WATERMELON MUSICÏúºÎ°ú ÏùåÏïÖÍ≥º Ìï®ÍªòÌïòÎäî Ï¶êÍ±∞Ïö¥ ÌïòÎ£® Î≥¥ÎÇ¥ÏÑ∏Ïöî!</span>
        </div>

    </footer>
</div>

<!-- axios -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"
        integrity="sha512-uMtXmF28A2Ab/JJO2t/vYhlaa/3ahUOgj1Zf27M5rOo8/+fcTUVH0/E0ll68njmjrLqOBjXM3V9NiPFL5ywWPQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script type="text/javascript" src="/js/search.js"></script>
<script >
    const volumeSlider = document.getElementById("volume-slider");
    const musicWrap = document.querySelector(".wrap__music");
    const musicImg = musicWrap.querySelector(".music__img img");
    const musicName = musicWrap.querySelector(".music__song .name");
    const musicArtist = musicWrap.querySelector(".music__song .artist");
    const musicAudio = musicWrap.querySelector("#main-audio");
    const musicPlay = musicWrap.querySelector("#control-play");
    const musicPrevBtn = musicWrap.querySelector("#control-prev");
    const musicNextBtn = musicWrap.querySelector("#control-next");
    const musicProgress = musicWrap.querySelector(".music__progress");
    const musicProgressBar = musicProgress.querySelector(".bar");
    const musicProgressCurrent = musicProgress.querySelector(".current");
    const musicProgressDuration = musicProgress.querySelector(".duration");
    const musicRepeat = musicWrap.querySelector("#control-repeat");
    const musicList = musicWrap.querySelector(".music__list");
    const MusicListBtn = musicWrap.querySelector("#control-list");
    const MusicListClose = musicList.querySelector(".close");
    const musicListUl = musicList.querySelector(".list ul");
    const MusicClick = document.querySelectorAll(".Music-Click");





    let allMusic = [];
    let musicIndex =1;


    function addMusic(num) {
        addMusicIndex = allMusic[num-1].dataIndex;
        localStorage.setItem("addMusicIndex",num);
        console.log("allMusic : " + allMusic);
        localStorage.setItem("allMusic", JSON.stringify(allMusic));
        console.log("LocalStorage.setItem : " + localStorage);
    }


    // Î≥ºÎ•®

    volumeSlider.addEventListener("input", () => {
        const volume = volumeSlider.value / 100;
        musicAudio.volume = volume;
    });

    // ÏùåÏïÖ Ïû¨ÏÉù
    function loadMusic(num){
        musicName.innerText = allMusic[num-1].title;
        musicArtist.innerText = allMusic[num-1].artist;

        title = allMusic[num-1].title;
        console.log("AudioPlayTitle : " + title);
        var encodedTitle  = encodeURIComponent(title);
        console.log("encodedTitle : " + encodedTitle);
        musicAudio.src = "http://localhost:8080/audio/"+encodedTitle +".mp3";
        console.log("musicAudio.src : " + musicAudio.src);

        addMusic(musicIndex);
        console.log("musicIndex : " +musicIndex);

    }

    // ÏùåÏïÖÏ†ïÎ≥¥Í∞ÄÏ†∏Ïò§Í∏∞
    MusicClick.forEach(element => {
        element.addEventListener("click", ()=>{
                var buttonText = element.textContent;
                console.log("ButtonText : " + buttonText);
                axios.post('/musicinfo', {
                        title : buttonText
                    })
                    .then(function (response) {

                        var title = response.data.title;
                        var artist = response.data.artist;
                        var musicPath = response.data.music_path;
                        var index = allMusic.length+1;

                        allMusic.push({
                            artist : artist,
                            title : title,
                            musicPath : musicPath,
                            dataIndex : index
                        });
                        console.log(allMusic);

                        addList();
                        console.log("index : " + index);
                        loadMusic(index);
                        playMusic();
                        playListMusic();



                    })
                    .catch(function (error) {
                        console.error("Mylist add fail.. : ", error);
                    });


        })
    })

    // Î¶¨Ïä§Ìä∏ Ï∂îÍ∞Ä
    function addList(){
        let i = allMusic.length -1;
        let li = `
               <li data-index="${allMusic[i].dataIndex}">
                    <div>
                       <em>${allMusic[i].title}</em>
                       <p>${allMusic[i].artist}</p>
                    </div>
                        <audio class="${allMusic[i].audio}" "></audio>
                        <span id="${allMusic[i].audio}" class="audio-duration">3:36</span>
               </li>
               `;
              musicListUl.insertAdjacentHTML("beforeend", li);
              console.log("li" + li);

              let liAudioDuration = musicListUl.querySelector(`#${allMusic[i].audio}`);
              let liAudio = musicListUl.querySelector(`.${allMusic[i].audio}`);

              liAudio.addEventListener("loadeddata", () => {
                  let audioDuration = liAudio.duration;
                  let totalMin = Math.floor(audioDuration / 60);
                  let totalSec = Math.floor(audioDuration % 60);
                  if (totalSec < 10) totalSec = `0${totalSec}`;

                  liAudioDuration.innerText = `${totalMin}:${totalSec}`;
                  liAudioDuration.setAttribute("data-duration", `${totalMin}:${totalSec}`);
        });
    }


    // ÌîåÎ†àÏù¥ Î≤ÑÌäº
    function playMusic(){
        musicWrap.classList.add("paused");
        musicPlay.innerText = "pause";
        musicPlay.setAttribute("title", "ÏùºÏãúÏ†ïÏßÄ")
        musicAudio.play();

    }

    // ÏùºÏãúÏ†ïÏßÄ Î≤ÑÌäº
    function pauseMusic(){
        musicWrap.classList.remove("paused");
        musicPlay.innerText = "play_arrow";
        musicPlay.setAttribute("title", "Ïû¨ÏÉù")
        musicAudio.pause();


    }

    // Ïù¥Ï†Ñ Í≥° Îì£Í∏∞ Î≤ÑÌäº
    function prevMusic(){
        musicIndex--;
        musicIndex < 1 ? musicIndex = allMusic.length : musicIndex = musicIndex;
        loadMusic(musicIndex);
        playMusic(musicIndex);
        playListMusic(musicIndex);
    }

    // Îã§Ïùå Í≥° Îì£Í∏∞ Î≤ÑÌäº
    function nextMusic(){
        musicIndex++;
        musicIndex > allMusic.length ? musicIndex = 1 : musicIndex = musicIndex;
        loadMusic(musicIndex);
        playMusic(musicIndex);
        playListMusic(musicIndex);
    }

    // ÎÆ§ÏßÅ ÏßÑÌñâÎ∞î
    musicAudio.addEventListener("timeupdate", (e)=>{
        const currentTime = e.target.currentTime;
        const duration = e.target.duration;
        let progressWidth = (currentTime/duration) * 100;
        musicProgressBar.style.width = `${progressWidth}%`

        musicAudio.addEventListener("loadeddata", ()=>{
            let audioDuration = musicAudio.duration;
            let totalMin = Math.floor(audioDuration / 60);
            let totalSec = Math.floor(audioDuration % 60);
            if (totalSec < 10) totalSec = `0${totalSec}`;

            musicProgressDuration.innerText = `${totalMin}:${totalSec}`;
        })

        let currentMin = Math.floor(currentTime / 60);
        let currentSec = Math.floor(currentTime % 60);
        if (currentSec < 10) currentSec = `0${currentSec}`;
        musicProgressCurrent.innerText = `${currentMin}:${currentSec}`
    })

    // ÏßÑÌñâ Î≤ÑÌäº
    musicProgress.addEventListener("click", e=>{
        let progressWidth = musicProgress.clientWidth;
        let clickedOffsetX = e.offsetX;
        let songDuration = musicAudio.duration;

        musicAudio.currentTime = (clickedOffsetX / progressWidth) * songDuration;
        playMusic();
    })




    // Ïû¨ÏÉù/ÏùºÏãúÏ†ïÏßÄ
    musicPlay.addEventListener("click", ()=>{
        const isMusicPaused = musicWrap.classList.contains("paused");
        isMusicPaused ? pauseMusic() : playMusic();
    })

    musicPrevBtn.addEventListener("click", ()=>{
        prevMusic();
    });
    musicNextBtn.addEventListener("click", ()=>{
        nextMusic();
    });

    // Î∞òÎ≥µ Î≤ÑÌäº
    musicRepeat.addEventListener("click", ()=>{
        let getText = musicRepeat.innerText;

        switch(getText){
            case "repeat" :
                musicRepeat.innerText = "repeat_one";
                musicRepeat.setAttribute("title", "ÌïúÍ≥° Î∞òÎ≥µ")
            break;

            case "repeat_one" :
                musicRepeat.innerText = "shuffle";
                musicRepeat.setAttribute("title", "ÎûúÎç§ Î∞òÎ≥µ")
            break;

            case "shuffle" :
                musicRepeat.innerText = "repeat";
                musicRepeat.setAttribute("title", "Ï†ÑÏ≤¥ Î∞òÎ≥µ")
                playListMusic();
            break;
        }
    })

    // Ïò§ÎîîÏò§Í∞Ä ÎÅùÎÇòÍ≥†
    musicAudio.addEventListener("ended", ()=>{
        let getText = musicRepeat.innerText;

        switch(getText){
            case "repeat" :
                nextMusic();
            break;

            case "repeat_one" :
                loadMusic(musicIndex);
                playMusic();
            break;

            case "shuffle" :
                let randIndex = Math.floor((Math.random() * allMusic.length) + 1);
                do {
                    randIndex = Math.floor((Math.random() * allMusic.length) + 1);
                } while (musicIndex == randIndex);
                musicIndex = randIndex;
                loadMusic(musicIndex);
                playMusic();
                playListMusic();
            break;
        }
    })

    // ÎÆ§ÏßÅ Î¶¨Ïä§Ìä∏ Î≤ÑÌäº
    MusicListBtn.addEventListener("click", ()=>{
        musicList.classList.add("show");
    })

    // ÎÆ§ÏßÅ Î¶¨Ïä§Ìä∏ Îã´Í∏∞ Î≤ÑÌäº
    MusicListClose.addEventListener("click", ()=>{
        musicList.classList.remove("show");
    })

    // ÎÆ§ÏßÅ Î¶¨Ïä§Ìä∏ Íµ¨ÌòÑÌïòÍ∏∞


    // ÎÆ§ÏßÅ Î¶¨Ïä§Ìä∏ ÌÅ¥Î¶≠ÌïòÍ∏∞

    function playListMusic(){
        const musicListAll = musicListUl.querySelectorAll("li");
        console.log("musicListAll : " +musicListAll.length);

        for(let j=0; j<musicListAll.length; j++){
        let audioTag = musicListAll[j].querySelector(".audio-duration");
        let adDuration = audioTag.getAttribute("data-duration");

        if (musicListAll[j].classList.contains("playing")) {
            musicListAll[j].classList.remove("playing");
            audioTag.innerText = adDuration;
        }

        if (musicListAll[j].getAttribute("data-index") == musicIndex) {
            musicListAll[j].classList.add("playing");
            audioTag.innerText = "Ïû¨ÏÉùÏ§ë";
            console.log("musicIndex : "+musicIndex);
        }
        musicListAll[j].setAttribute("onclick", "clicked(this)");
    }
}

    function clicked(el){

        let getLiIndex = el.getAttribute("data-index");
        musicIndex = getLiIndex;
        console.log("musicIndex Î≥ÄÌôî : " + musicIndex);

        loadMusic(musicIndex);
        playMusic();
        playListMusic();
    }
    // Ï∞ΩÏù¥ Ïó¥Î¶¨Î©¥ ÎÖ∏Îûò Ïãú


</script>


</body>
</html>